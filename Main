-- DaHood Aimbot (Persists Through Death)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local CoreGui = game:GetService("CoreGui")

-- Local player reference
local LocalPlayer = Players.LocalPlayer

-- Configuration
local Config = {
    Enabled = true,
    FOV = 120,
    Smoothness = 0.25,
    Prediction = 0.165,
    HeadshotMode = true,
    MaxDistance = 300,
    LockedTarget = nil
}

-- Create persistent mobile GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = CoreGui
ScreenGui.Name = "MobileAimbotUI"
ScreenGui.ResetOnSpawn = false  -- Critical for persistence

local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0.2, 0, 0.1, 0)
ToggleButton.Position = UDim2.new(0.75, 0, 0.85, 0)
ToggleButton.Text = "AIM: ON"
ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextScaled = true
ToggleButton.Parent = ScreenGui

-- Drawing objects (persist through death)
local LockIndicator = Drawing.new("Circle")
LockIndicator.Visible = false
LockIndicator.Color = Color3.fromRGB(0, 255, 0)
LockIndicator.Thickness = 2
LockIndicator.Radius = 8
LockIndicator.Filled = false

local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = true
FOVCircle.Transparency = 0.7
FOVCircle.Color = Color3.fromRGB(255, 50, 50)
FOVCircle.Thickness = 1
FOVCircle.Filled = false

-- Toggle functionality
ToggleButton.MouseButton1Click:Connect(function()
    Config.Enabled = not Config.Enabled
    ToggleButton.Text = Config.Enabled and "AIM: ON" or "AIM: OFF"
    ToggleButton.BackgroundColor3 = Config.Enabled 
        and Color3.fromRGB(50, 150, 50) 
        or Color3.fromRGB(150, 50, 50)
    
    if not Config.Enabled then
        Config.LockedTarget = nil
        LockIndicator.Visible = false
    end
end)

-- Death-resistant target validation
local function IsTargetValid(player)
    if not player then return false end
    if not player.Character then return false end
    
    local character = player.Character
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return false end
    
    local targetPart = Config.HeadshotMode and character:FindFirstChild("Head") or character:FindFirstChild("HumanoidRootPart")
    if not targetPart then return false end
    
    -- Skip distance check when dead (lock remains)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local distance = (targetPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
        if distance > Config.MaxDistance then return false end
    end
    
    return true
end

-- Target acquisition with respawn handling
local function GetClosestTarget()
    -- Maintain lock through death if target still valid
    if Config.LockedTarget and IsTargetValid(Config.LockedTarget) then
        return Config.LockedTarget
    end
    
    -- Find new target (works even when dead)
    Config.LockedTarget = nil
    LockIndicator.Visible = false
    
    local screenCenter = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    local closestPlayer, closestDist = nil, Config.FOV
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        if not IsTargetValid(player) then continue end
        
        local character = player.Character
        local targetPart = Config.HeadshotMode and character:FindFirstChild("Head") or character:FindFirstChild("HumanoidRootPart")
        
        local screenPos = Camera:WorldToViewportPoint(targetPart.Position)
        if screenPos.Z <= 0 then continue end
        
        local screenPoint = Vector2.new(screenPos.X, screenPos.Y)
        local distance = (screenPoint - screenCenter).Magnitude
        
        if distance < closestDist then
            closestDist = distance
            closestPlayer = player
        end
    end
    
    if closestPlayer then
        Config.LockedTarget = closestPlayer
        LockIndicator.Visible = true
    end
    
    return closestPlayer
end

-- Death-resistant aiming
local function AimAtTarget()
    if not Config.Enabled then return end
    
    local target = GetClosestTarget()
    if not target or not target.Character then return end
    
    local character = target.Character
    local targetPart = Config.HeadshotMode and character:FindFirstChild("Head") or character:FindFirstChild("HumanoidRootPart")
    if not targetPart then return end
    
    -- Update lock indicator
    local screenPos = Camera:WorldToViewportPoint(targetPart.Position)
    if screenPos.Z > 0 then
        LockIndicator.Position = Vector2.new(screenPos.X, screenPos.Y)
    end
    
    -- Only aim if we have a character
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local predictedPos = targetPart.Position + (targetPart.Velocity * Config.Prediction)
        local targetCF = CFrame.new(Camera.CFrame.Position, predictedPos)
        Camera.CFrame = Camera.CFrame:Lerp(targetCF, Config.Smoothness)
    end
end

-- Main loop (always runs)
RunService.Heartbeat:Connect(function()
    -- Update visuals
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOVCircle.Radius = Config.FOV
    
    -- Maintain functionality
    AimAtTarget()
    
    -- Clean invalid locks
    if Config.LockedTarget and not IsTargetValid(Config.LockedTarget) then
        Config.LockedTarget = nil
        LockIndicator.Visible = false
    end
end)

-- Permanent cleanup only when leaving game
game:BindToClose(function()
    FOVCircle:Remove()
    LockIndicator:Remove()
    ScreenGui:Destroy()
end)

print("Persistent Aimbot Loaded | Survives through death")
